Object.defineProperty(exports,"__esModule",{value:true});exports.productListSelector=undefined;var cov_1lae85vwkg=function(){var path='/Users/amitkumar/iTrueService/DevCode/iservice-app/app/redux/sagas/ebill.saga.js',hash='4fbd97fae874b33211e5246baef534eeb4c2cff1',global=new Function('return this')(),gcv='__coverage__',coverageData={path:'/Users/amitkumar/iTrueService/DevCode/iservice-app/app/redux/sagas/ebill.saga.js',statementMap:{'0':{start:{line:10,column:26},end:{line:46,column:1}},'1':{start:{line:11,column:23},end:{line:11,column:25}},'2':{start:{line:12,column:2},end:{line:43,column:5}},'3':{start:{line:13,column:4},end:{line:15,column:5}},'4':{start:{line:14,column:6},end:{line:14,column:13}},'5':{start:{line:17,column:4},end:{line:42,column:5}},'6':{start:{line:22,column:6},end:{line:35,column:9}},'7':{start:{line:23,column:28},end:{line:23,column:57}},'8':{start:{line:24,column:8},end:{line:34,column:9}},'9':{start:{line:24,column:43},end:{line:24,column:66}},'10':{start:{line:25,column:22},end:{line:25,column:50}},'11':{start:{line:26,column:10},end:{line:26,column:32}},'12':{start:{line:27,column:10},end:{line:27,column:55}},'13':{start:{line:29,column:10},end:{line:33,column:13}},'14':{start:{line:30,column:24},end:{line:30,column:41}},'15':{start:{line:31,column:12},end:{line:31,column:34}},'16':{start:{line:32,column:12},end:{line:32,column:46}},'17':{start:{line:37,column:6},end:{line:41,column:9}},'18':{start:{line:38,column:20},end:{line:38,column:37}},'19':{start:{line:39,column:8},end:{line:39,column:30}},'20':{start:{line:40,column:8},end:{line:40,column:42}},'21':{start:{line:45,column:2},end:{line:45,column:22}},'22':{start:{line:48,column:42},end:{line:58,column:1}},'23':{start:{line:49,column:17},end:{line:49,column:19}},'24':{start:{line:50,column:2},end:{line:56,column:5}},'25':{start:{line:51,column:16},end:{line:54,column:6}},'26':{start:{line:52,column:30},end:{line:52,column:56}},'27':{start:{line:53,column:6},end:{line:53,column:48}},'28':{start:{line:55,column:4},end:{line:55,column:22}},'29':{start:{line:57,column:2},end:{line:57,column:16}},'30':{start:{line:60,column:23},end:{line:81,column:1}},'31':{start:{line:61,column:25},end:{line:61,column:42}},'32':{start:{line:62,column:20},end:{line:62,column:22}},'33':{start:{line:63,column:2},end:{line:78,column:3}},'34':{start:{line:65,column:4},end:{line:65,column:32}},'35':{start:{line:66,column:4},end:{line:66,column:10}},'36':{start:{line:69,column:4},end:{line:69,column:24}},'37':{start:{line:70,column:4},end:{line:70,column:10}},'38':{start:{line:73,column:4},end:{line:73,column:24}},'39':{start:{line:74,column:4},end:{line:74,column:10}},'40':{start:{line:80,column:2},end:{line:80,column:21}},'41':{start:{line:83,column:55},end:{line:118,column:1}},'42':{start:{line:84,column:27},end:{line:84,column:34}},'43':{start:{line:85,column:2},end:{line:115,column:5}},'44':{start:{line:86,column:4},end:{line:114,column:5}},'45':{start:{line:87,column:21},end:{line:87,column:25}},'46':{start:{line:88,column:29},end:{line:88,column:31}},'47':{start:{line:90,column:6},end:{line:98,column:9}},'48':{start:{line:91,column:8},end:{line:96,column:11}},'49':{start:{line:92,column:10},end:{line:95,column:11}},'50':{start:{line:93,column:12},end:{line:93,column:73}},'51':{start:{line:94,column:12},end:{line:94,column:49}},'52':{start:{line:97,column:8},end:{line:97,column:52}},'53':{start:{line:101,column:33},end:{line:101,column:93}},'54':{start:{line:101,column:64},end:{line:101,column:92}},'55':{start:{line:104,column:28},end:{line:104,column:83}},'56':{start:{line:107,column:31},end:{line:107,column:132}},'57':{start:{line:107,column:66},end:{line:107,column:130}},'58':{start:{line:110,column:27},end:{line:110,column:149}},'59':{start:{line:110,column:61},end:{line:110,column:147}},'60':{start:{line:113,column:6},end:{line:113,column:66}},'61':{start:{line:113,column:37},end:{line:113,column:64}},'62':{start:{line:117,column:2},end:{line:117,column:26}},'63':{start:{line:120,column:35},end:{line:120,column:71}},'64':{start:{line:123,column:2},end:{line:130,column:3}},'65':{start:{line:124,column:31},end:{line:124,column:72}},'66':{start:{line:125,column:24},end:{line:125,column:57}},'67':{start:{line:126,column:26},end:{line:126,column:116}},'68':{start:{line:127,column:4},end:{line:127,column:60}},'69':{start:{line:134,column:2},end:{line:154,column:3}},'70':{start:{line:135,column:24},end:{line:135,column:57}},'71':{start:{line:136,column:21},end:{line:136,column:54}},'72':{start:{line:138,column:29},end:{line:138,column:94}},'73':{start:{line:140,column:4},end:{line:140,column:53}},'74':{start:{line:141,column:4},end:{line:141,column:73}},'75':{start:{line:143,column:4},end:{line:153,column:8}},'76':{start:{line:158,column:2},end:{line:158,column:72}},'77':{start:{line:159,column:2},end:{line:159,column:58}}},fnMap:{'0':{name:'(anonymous_0)',decl:{start:{line:10,column:26},end:{line:10,column:27}},loc:{start:{line:10,column:43},end:{line:46,column:1}},line:10},'1':{name:'(anonymous_1)',decl:{start:{line:12,column:25},end:{line:12,column:26}},loc:{start:{line:12,column:41},end:{line:43,column:3}},line:12},'2':{name:'(anonymous_2)',decl:{start:{line:22,column:19},end:{line:22,column:20}},loc:{start:{line:22,column:28},end:{line:35,column:7}},line:22},'3':{name:'(anonymous_3)',decl:{start:{line:24,column:33},end:{line:24,column:34}},loc:{start:{line:24,column:43},end:{line:24,column:66}},line:24},'4':{name:'(anonymous_4)',decl:{start:{line:29,column:29},end:{line:29,column:30}},loc:{start:{line:29,column:38},end:{line:33,column:11}},line:29},'5':{name:'(anonymous_5)',decl:{start:{line:37,column:19},end:{line:37,column:20}},loc:{start:{line:37,column:28},end:{line:41,column:7}},line:37},'6':{name:'(anonymous_6)',decl:{start:{line:48,column:42},end:{line:48,column:43}},loc:{start:{line:48,column:76},end:{line:58,column:1}},line:48},'7':{name:'(anonymous_7)',decl:{start:{line:50,column:29},end:{line:50,column:30}},loc:{start:{line:50,column:45},end:{line:56,column:3}},line:50},'8':{name:'(anonymous_8)',decl:{start:{line:51,column:29},end:{line:51,column:30}},loc:{start:{line:51,column:38},end:{line:54,column:5}},line:51},'9':{name:'(anonymous_9)',decl:{start:{line:60,column:23},end:{line:60,column:24}},loc:{start:{line:60,column:33},end:{line:81,column:1}},line:60},'10':{name:'(anonymous_10)',decl:{start:{line:83,column:55},end:{line:83,column:56}},loc:{start:{line:83,column:78},end:{line:118,column:1}},line:83},'11':{name:'(anonymous_11)',decl:{start:{line:85,column:26},end:{line:85,column:27}},loc:{start:{line:85,column:36},end:{line:115,column:3}},line:85},'12':{name:'(anonymous_12)',decl:{start:{line:90,column:22},end:{line:90,column:23}},loc:{start:{line:90,column:36},end:{line:98,column:7}},line:90},'13':{name:'(anonymous_13)',decl:{start:{line:91,column:53},end:{line:91,column:54}},loc:{start:{line:91,column:72},end:{line:96,column:9}},line:91},'14':{name:'(anonymous_14)',decl:{start:{line:101,column:50},end:{line:101,column:51}},loc:{start:{line:101,column:64},end:{line:101,column:92}},line:101},'15':{name:'(anonymous_15)',decl:{start:{line:107,column:52},end:{line:107,column:53}},loc:{start:{line:107,column:66},end:{line:107,column:130}},line:107},'16':{name:'(anonymous_16)',decl:{start:{line:110,column:51},end:{line:110,column:52}},loc:{start:{line:110,column:61},end:{line:110,column:147}},line:110},'17':{name:'(anonymous_17)',decl:{start:{line:113,column:27},end:{line:113,column:28}},loc:{start:{line:113,column:37},end:{line:113,column:64}},line:113},'18':{name:'fetchBillingPreference',decl:{start:{line:122,column:17},end:{line:122,column:39}},loc:{start:{line:122,column:52},end:{line:131,column:1}},line:122},'19':{name:'applyForEBill',decl:{start:{line:133,column:17},end:{line:133,column:30}},loc:{start:{line:133,column:43},end:{line:155,column:1}},line:133},'20':{name:'ebillSaga',decl:{start:{line:157,column:25},end:{line:157,column:34}},loc:{start:{line:157,column:38},end:{line:160,column:1}},line:157}},branchMap:{'0':{loc:{start:{line:13,column:4},end:{line:15,column:5}},type:'if',locations:[{start:{line:13,column:4},end:{line:15,column:5}},{start:{line:13,column:4},end:{line:15,column:5}}],line:13},'1':{loc:{start:{line:17,column:4},end:{line:42,column:5}},type:'if',locations:[{start:{line:17,column:4},end:{line:42,column:5}},{start:{line:17,column:4},end:{line:42,column:5}}],line:17},'2':{loc:{start:{line:24,column:8},end:{line:34,column:9}},type:'if',locations:[{start:{line:24,column:8},end:{line:34,column:9}},{start:{line:24,column:8},end:{line:34,column:9}}],line:24},'3':{loc:{start:{line:63,column:2},end:{line:78,column:3}},type:'switch',locations:[{start:{line:64,column:2},end:{line:67,column:3}},{start:{line:68,column:2},end:{line:71,column:3}},{start:{line:72,column:2},end:{line:75,column:3}},{start:{line:76,column:2},end:{line:76,column:10}}],line:63},'4':{loc:{start:{line:86,column:4},end:{line:114,column:5}},type:'if',locations:[{start:{line:86,column:4},end:{line:114,column:5}},{start:{line:86,column:4},end:{line:114,column:5}}],line:86},'5':{loc:{start:{line:92,column:10},end:{line:95,column:11}},type:'if',locations:[{start:{line:92,column:10},end:{line:95,column:11}},{start:{line:92,column:10},end:{line:95,column:11}}],line:92},'6':{loc:{start:{line:92,column:14},end:{line:92,column:96}},type:'binary-expr',locations:[{start:{line:92,column:15},end:{line:92,column:57}},{start:{line:92,column:63},end:{line:92,column:95}}],line:92}},s:{'0':0,'1':0,'2':0,'3':0,'4':0,'5':0,'6':0,'7':0,'8':0,'9':0,'10':0,'11':0,'12':0,'13':0,'14':0,'15':0,'16':0,'17':0,'18':0,'19':0,'20':0,'21':0,'22':0,'23':0,'24':0,'25':0,'26':0,'27':0,'28':0,'29':0,'30':0,'31':0,'32':0,'33':0,'34':0,'35':0,'36':0,'37':0,'38':0,'39':0,'40':0,'41':0,'42':0,'43':0,'44':0,'45':0,'46':0,'47':0,'48':0,'49':0,'50':0,'51':0,'52':0,'53':0,'54':0,'55':0,'56':0,'57':0,'58':0,'59':0,'60':0,'61':0,'62':0,'63':0,'64':0,'65':0,'66':0,'67':0,'68':0,'69':0,'70':0,'71':0,'72':0,'73':0,'74':0,'75':0,'76':0,'77':0},f:{'0':0,'1':0,'2':0,'3':0,'4':0,'5':0,'6':0,'7':0,'8':0,'9':0,'10':0,'11':0,'12':0,'13':0,'14':0,'15':0,'16':0,'17':0,'18':0,'19':0,'20':0},b:{'0':[0,0],'1':[0,0],'2':[0,0],'3':[0,0,0,0],'4':[0,0],'5':[0,0],'6':[0,0]},_coverageSchema:'332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};exports.
























































































































fetchBillingPreference=fetchBillingPreference;exports.










applyForEBill=applyForEBill;exports.default=























ebillSaga;var _lodash=require('lodash');var _lodash2=_interopRequireDefault(_lodash);var _api=require('./api/api.saga');var _api2=_interopRequireDefault(_api);var _apiHelper=require('./api/apiHelper');var _effects=require('redux-saga/effects');var _common=require('../../utils/common.util');var _reactNavigation=require('react-navigation');var _helper=require('../../language/i18n/helper');var _index=require('../actions/index.actions');var actions=_interopRequireWildcard(_index);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj;}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key];}}newObj.default=obj;return newObj;}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}var _marked=regeneratorRuntime.mark(fetchBillingPreference),_marked2=regeneratorRuntime.mark(applyForEBill),_marked3=regeneratorRuntime.mark(ebillSaga);cov_1lae85vwkg.s[0]++;var formatProductList=function formatProductList(productList){cov_1lae85vwkg.f[0]++;var formattedRes=(cov_1lae85vwkg.s[1]++,{});cov_1lae85vwkg.s[2]++;_lodash2.default.forEach(productList,function(array,key){cov_1lae85vwkg.f[1]++;cov_1lae85vwkg.s[3]++;if(key==='tmhPrepaid'){cov_1lae85vwkg.b[0][0]++;cov_1lae85vwkg.s[4]++;return;}else{cov_1lae85vwkg.b[0][1]++;}cov_1lae85vwkg.s[5]++;if(key==='conv'){cov_1lae85vwkg.b[1][0]++;cov_1lae85vwkg.s[6]++;_lodash2.default.map(array,function(val){cov_1lae85vwkg.f[2]++;var productList=(cov_1lae85vwkg.s[7]++,_lodash2.default.result(val,'products',[]));cov_1lae85vwkg.s[8]++;if(_lodash2.default.every(productList,function(item){cov_1lae85vwkg.f[3]++;cov_1lae85vwkg.s[9]++;return item.isBillConsolidated;})){cov_1lae85vwkg.b[2][0]++;var obj=(cov_1lae85vwkg.s[10]++,_lodash2.default.assign({},productList[0]));cov_1lae85vwkg.s[11]++;obj.accountType=key;cov_1lae85vwkg.s[12]++;formattedRes[productList[0].accountId]=obj;}else{cov_1lae85vwkg.b[2][1]++;cov_1lae85vwkg.s[13]++;_lodash2.default.map(productList,function(val){cov_1lae85vwkg.f[4]++;var obj=(cov_1lae85vwkg.s[14]++,_lodash2.default.assign({},val));cov_1lae85vwkg.s[15]++;obj.accountType=key;cov_1lae85vwkg.s[16]++;formattedRes[val.accountId]=obj;});}});}else{cov_1lae85vwkg.b[1][1]++;cov_1lae85vwkg.s[17]++;_lodash2.default.map(array,function(val){cov_1lae85vwkg.f[5]++;var obj=(cov_1lae85vwkg.s[18]++,_lodash2.default.assign({},val));cov_1lae85vwkg.s[19]++;obj.accountType=key;cov_1lae85vwkg.s[20]++;formattedRes[val.accountId]=obj;});}});cov_1lae85vwkg.s[21]++;return formattedRes;};cov_1lae85vwkg.s[22]++;var mergeProductListAndBillPreference=function mergeProductListAndBillPreference(productList,billPreferences){cov_1lae85vwkg.f[6]++;var result=(cov_1lae85vwkg.s[23]++,{});cov_1lae85vwkg.s[24]++;_lodash2.default.forEach(billPreferences,function(array,key){cov_1lae85vwkg.f[7]++;var res=(cov_1lae85vwkg.s[25]++,_lodash2.default.map(array,function(obj){cov_1lae85vwkg.f[8]++;var productListData=(cov_1lae85vwkg.s[26]++,productList[obj.accountID]);cov_1lae85vwkg.s[27]++;return _lodash2.default.assign({},obj,productListData);}));cov_1lae85vwkg.s[28]++;result[key]=res;});cov_1lae85vwkg.s[29]++;return result;};cov_1lae85vwkg.s[30]++;var mapAccountType=function mapAccountType(type){cov_1lae85vwkg.f[9]++;var camelCasedType=(cov_1lae85vwkg.s[31]++,_lodash2.default.camelCase(type));var accountType=(cov_1lae85vwkg.s[32]++,'');cov_1lae85vwkg.s[33]++;switch(camelCasedType){case'trueMoveH':cov_1lae85vwkg.b[3][0]++;{cov_1lae85vwkg.s[34]++;accountType='tmhPostpaid';cov_1lae85vwkg.s[35]++;break;}case'trueVision':cov_1lae85vwkg.b[3][1]++;{cov_1lae85vwkg.s[36]++;accountType='tvs';cov_1lae85vwkg.s[37]++;break;}case'trueOnline':cov_1lae85vwkg.b[3][2]++;{cov_1lae85vwkg.s[38]++;accountType='tol';cov_1lae85vwkg.s[39]++;break;}default:cov_1lae85vwkg.b[3][3]++;}cov_1lae85vwkg.s[40]++;return accountType;};cov_1lae85vwkg.s[41]++;var addConvergenceAccountIDsToRegisterEbillPayload=function addConvergenceAccountIDsToRegisterEbillPayload(payload,convList){cov_1lae85vwkg.f[10]++;var formattedPayload=(cov_1lae85vwkg.s[42]++,payload);cov_1lae85vwkg.s[43]++;_lodash2.default.map(formattedPayload,function(item){cov_1lae85vwkg.f[11]++;cov_1lae85vwkg.s[44]++;if(item.accountType==='conv'){cov_1lae85vwkg.b[4][0]++;var bundleID=(cov_1lae85vwkg.s[45]++,null);var accountInPayload=(cov_1lae85vwkg.s[46]++,{});cov_1lae85vwkg.s[47]++;_lodash2.default.map(convList,function(convItem){cov_1lae85vwkg.f[12]++;cov_1lae85vwkg.s[48]++;accountInPayload=_lodash2.default.find(convItem.products,function(convInnerItem){cov_1lae85vwkg.f[13]++;cov_1lae85vwkg.s[49]++;if((cov_1lae85vwkg.b[6][0]++,convInnerItem.accountId===item.accountID)&&(cov_1lae85vwkg.b[6][1]++,convInnerItem.isBillConsolidated)){cov_1lae85vwkg.b[5][0]++;cov_1lae85vwkg.s[50]++;item.accountType=mapAccountType(convInnerItem.productType);cov_1lae85vwkg.s[51]++;return convInnerItem.convergenceCode;}else{cov_1lae85vwkg.b[5][1]++;}});cov_1lae85vwkg.s[52]++;bundleID=accountInPayload.convergenceCode;});var accountsInBundleID=(cov_1lae85vwkg.s[53]++,_lodash2.default.find(convList,function(convItem){cov_1lae85vwkg.f[14]++;cov_1lae85vwkg.s[54]++;return convItem.bundle===bundleID;}));var accountsToAdd=(cov_1lae85vwkg.s[55]++,_lodash2.default.reject(accountsInBundleID.products,accountInPayload));var accountsToAddIDs=(cov_1lae85vwkg.s[56]++,_lodash2.default.map(accountsToAdd,function(account){cov_1lae85vwkg.f[15]++;cov_1lae85vwkg.s[57]++;return{accountID:account.accountId,accountType:account.productType};}));var payloadToAdd=(cov_1lae85vwkg.s[58]++,_lodash2.default.map(accountsToAddIDs,function(val){cov_1lae85vwkg.f[16]++;cov_1lae85vwkg.s[59]++;return _extends({},item,{accountID:val.accountID,accountType:mapAccountType(val.accountType)});}));cov_1lae85vwkg.s[60]++;_lodash2.default.each(payloadToAdd,function(item){cov_1lae85vwkg.f[17]++;cov_1lae85vwkg.s[61]++;return formattedPayload.push(item);});}else{cov_1lae85vwkg.b[4][1]++;}});cov_1lae85vwkg.s[62]++;return formattedPayload;};var productListSelector=exports.productListSelector=(cov_1lae85vwkg.s[63]++,(0,_common.getSelector)('billUsage.productList'));function fetchBillingPreference(_ref){var payload=_ref.payload;var billPreferencesRes,productList,mergedPayload;return regeneratorRuntime.wrap(function fetchBillingPreference$(_context){while(1){switch(_context.prev=_context.next){case 0:cov_1lae85vwkg.f[18]++;cov_1lae85vwkg.s[64]++;_context.prev=2;cov_1lae85vwkg.s[65]++;_context.next=6;return(0,_effects.call)(_api2.default,(0,_apiHelper.billPreferences)(payload));case 6:billPreferencesRes=_context.sent;cov_1lae85vwkg.s[66]++;_context.next=10;return(0,_effects.select)(productListSelector);case 10:productList=_context.sent;mergedPayload=(cov_1lae85vwkg.s[67]++,mergeProductListAndBillPreference(formatProductList(productList),billPreferencesRes.body));cov_1lae85vwkg.s[68]++;_context.next=15;return(0,_effects.put)(actions.setBillingPreferences(mergedPayload));case 15:_context.next=19;break;case 17:_context.prev=17;_context.t0=_context['catch'](2);case 19:case'end':return _context.stop();}}},_marked,this,[[2,17]]);}function applyForEBill(_ref2){var payload=_ref2.payload;var productList,convList,formattedPayload;return regeneratorRuntime.wrap(function applyForEBill$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:cov_1lae85vwkg.f[19]++;cov_1lae85vwkg.s[69]++;_context2.prev=2;cov_1lae85vwkg.s[70]++;_context2.next=6;return(0,_effects.select)(productListSelector);case 6:productList=_context2.sent;convList=(cov_1lae85vwkg.s[71]++,_lodash2.default.result(productList,'conv',[]));formattedPayload=(cov_1lae85vwkg.s[72]++,addConvergenceAccountIDsToRegisterEbillPayload(payload,convList));cov_1lae85vwkg.s[73]++;_context2.next=12;return(0,_effects.call)(_api2.default,(0,_apiHelper.registerEbill)(formattedPayload));case 12:cov_1lae85vwkg.s[74]++;_context2.next=15;return(0,_effects.put)(_reactNavigation.NavigationActions.navigate({routeName:'BillingMethods'}));case 15:_context2.next=22;break;case 17:_context2.prev=17;_context2.t0=_context2['catch'](2);cov_1lae85vwkg.s[75]++;_context2.next=22;return(0,_effects.put)(actions.showPopup({title:(0,_helper.translate)('BILLING_METHODS__ADD_BAD_REQUEST'),body:(0,_helper.translate)('BILLING_METHODS__ADD__BAD_REQUEST_BODY'),buttons:[{title:(0,_helper.translate)('BUTTON__OK'),actionType:'Navigation/NAVIGATE',nextAction:{routeName:'BillingMethods'}}]}));case 22:case'end':return _context2.stop();}}},_marked2,this,[[2,17]]);}function ebillSaga(){return regeneratorRuntime.wrap(function ebillSaga$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:cov_1lae85vwkg.f[20]++;cov_1lae85vwkg.s[76]++;_context3.next=4;return(
(0,_effects.takeEvery)(actions.GET_BILL_PREFERENCES,fetchBillingPreference));case 4:cov_1lae85vwkg.s[77]++;_context3.next=7;return(
(0,_effects.takeEvery)(actions.APPLY_FOR_EBILL,applyForEBill));case 7:case'end':return _context3.stop();}}},_marked3,this);}